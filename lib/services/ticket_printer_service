// import 'dart:convert';
// import 'dart:developer';
// import 'package:intl/intl.dart';
// import '../models/api_ticket_response.dart';
// import 'sticker_printer_service.dart';

// class TicketPrinterService {
//   // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Instance ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 1 (StickerPrinterService)
//   final StickerPrinterService _printer = StickerPrinterService.instance;

//   Future<void> printTickets(
//     List<ApiTicketResponse> tickets,
//     String sellerName,
//   ) async {
//     try {
//       log("üñ®Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå...");

//       // ‚úÖ [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡πÉ‡∏ä‡πâ isConnectedNotifier.value ‡πÅ‡∏ó‡∏ô Getter isConnected
//       // ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å ValueNotifier
//       if (!_printer.isConnectedNotifier.value) {
//         log("‚ö†Ô∏è Printer not connected. (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô)");
//         return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
//       }

//       // 1. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô (Header ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô)
//       const String shopNameHeader = "Laodoove";

//       for (var ticket in tickets) {
//         // --- A. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡∏∞ ‡πÄ‡∏ß‡∏•‡∏≤ (‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô) ---
//         DateTime parsedDate;
//         try {
//           // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å String ‡πÄ‡∏õ‡πá‡∏ô DateTime
//           parsedDate = DateTime.parse(ticket.purchaseDate);
//         } catch (e) {
//           parsedDate = DateTime.now();
//         }

//         // ‡πÅ‡∏¢‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: 27/11/2025
//         String dateText = DateFormat('dd/MM/yyyy').format(parsedDate);
//         // ‡πÅ‡∏¢‡∏Å‡πÄ‡∏ß‡∏•‡∏≤: 13:36
//         String timeText = DateFormat('HH:mm').format(parsedDate);

//         // --- B. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ï‡∏±‡πã‡∏ß (‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô Error Font) ---
//         String typeText;
//         String countText;

//         if (ticket.adultCount > 0) {
//           // ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ TSC ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏≠‡∏Å‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
//           typeText = "ADULT";
//           countText = "${ticket.adultCount}";
//         } else {
//           typeText = "CHILD";
//           countText = "${ticket.childCount > 0 ? ticket.childCount : 1}";
//         }

//         // ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á: "ADULT x 1 Qty"
//         String fullTypeString = "$typeText x $countText Qty";

//         // --- C. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô ---
//         List<String> rides = ticket.rideNames;

//         // --- D. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• QR Code ---
//         Map<String, String> qrDataMap = {
//           "purchase": ticket.purchaseId.toString(),
//           "visitor": ticket.visitorUid,
//         };
//         String qrJsonString = jsonEncode(qrDataMap);

//         // --- E. ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå StickerPrinterService ---
//         await _printer.printTicket(
//           ticketId: ticket.purchaseId.toString(),
//           shopName: shopNameHeader,
//           date: dateText,
//           time: timeText,
//           ticketType: fullTypeString,
//           rideList: rides,
//           qrData: qrJsonString,
//         );

//         // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 0.6 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Printer Buffer ‡πÄ‡∏ï‡πá‡∏°
//         await Future.delayed(const Duration(milliseconds: 600));
//       }

//       log("‚úÖ ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡πÉ‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
//     } catch (e) {
//       log("‚ùå Error printing stickers: $e");
//       // rethrow ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ UI ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ error (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
//     }
//   }
// }
